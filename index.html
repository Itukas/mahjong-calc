<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>日麻点数计算器 (紧凑版)</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #e74c3c;
            --bg-color: #f4f7f6;
            --panel-bg: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--primary-color);
            margin: 0;
            padding: 8px; /* 极窄边距 */
            display: flex;
            justify-content: center;
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
            /* 确保底部不被遮挡 */
            min-height: 100vh;
            box-sizing: border-box;
        }

        .container {
            background-color: var(--panel-bg);
            width: 100%;
            max-width: 600px;
            padding: 15px; /* 内部也更紧凑 */
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            font-size: 1.1rem; /* 标题变小 */
            margin: 0 0 12px 0;
            color: #7f8c8d;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }

        /* 布局网格：用于把人数和自风放一行 */
        .compact-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .control-group {
            margin-bottom: 10px; /* 间距减半 */
        }

        .label-title {
            font-weight: 600;
            margin-bottom: 5px;
            display: block;
            font-size: 0.8rem; /* 标签字体变小 */
            color: #95a5a6;
        }

        /* 按钮组样式 (Radio) - 更加扁平紧凑 */
        .radio-group {
            display: flex;
            gap: 4px;
            background: #f0f2f5;
            padding: 3px;
            border-radius: 6px;
        }

        .radio-group label {
            flex: 1;
            text-align: center;
            padding: 6px 0; /* 高度减半 */
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.1s;
            font-size: 0.85rem;
            -webkit-tap-highlight-color: transparent;
            color: #555;
        }

        .radio-group input[type="radio"] {
            display: none;
        }

        .radio-group input[type="radio"]:checked + label {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* 步进器样式 - 变矮 */
        .stepper {
            display: flex;
            align-items: center;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow: hidden;
            height: 38px; /* 高度从48px减小到38px */
        }

        .stepper-btn {
            background-color: #f8f9fa;
            border: none;
            width: 45px;
            height: 100%;
            font-size: 1.2rem;
            font-weight: 400;
            color: var(--primary-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        .stepper-btn:active {
            background-color: #e2e6ea;
        }

        .stepper input {
            flex: 1;
            height: 100%;
            border: none;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-color);
            -moz-appearance: textfield;
            padding: 0;
            margin: 0;
            user-select: none; /* 步进器输入框通常不需要键盘输入，防止弹出键盘遮挡 */
            pointer-events: none; /* 既然有加减号，禁用直接点击输入框可以防止软键盘弹出，体验更好 */
        }

        /* 符数面板 - 紧凑化 */
        #fu-calculation-panel {
            background-color: #fafbfc;
            border: 1px solid #edf2f7;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            display: none;
        }

        .fu-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            padding-bottom: 6px;
            border-bottom: 1px dashed #eee;
        }

        .fu-row label {
            font-size: 0.85rem;
        }

        .fu-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .fu-row .stepper {
            height: 32px; /* 符数调节更小一点 */
            width: 100px;
        }

        .fu-row .stepper-btn {
            width: 30px;
            font-size: 1rem;
        }

        .fu-row .stepper input {
            font-size: 0.9rem;
        }

        .checkbox-container {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 8px;
        }

        .checkbox-row {
            display: flex;
            align-items: center;
            background: #fff;
            padding: 8px 10px;
            border-radius: 6px;
            border: 1px solid #eee;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .checkbox-row.special-row {
            background-color: #fff8e1;
            border-color: #ffe082;
            padding: 6px 10px; /* 七对子按钮更紧凑 */
        }

        .checkbox-row input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            accent-color: var(--primary-color);
        }

        /* 结果区域 - 视觉重点 */
        #result-area {
            margin-top: auto; /* 推到底部，但如果内容少则紧贴上方 */
            padding: 15px;
            background-color: #2c3e50; /* 深色背景，更醒目 */
            color: #fff;
            border-radius: 10px;
            text-align: center;
            margin-top: 15px;
            box-shadow: 0 4px 10px rgba(44, 62, 80, 0.2);
            transition: all 0.2s;
        }

        .result-points {
            font-size: 2.2rem;
            font-weight: 800;
            color: #fff; /* 白色文字 */
            line-height: 1.1;
        }

        .result-title {
            font-size: 1.1rem;
            color: #f1c40f; /* 金色显示役满/满贯等 */
            margin-bottom: 4px;
            font-weight: bold;
        }

        .result-detail {
            margin-top: 5px;
            font-size: 0.9rem;
            color: #bdc3c7;
        }

        .disabled-area {
            opacity: 0.3;
            pointer-events: none;
            filter: grayscale(100%);
        }

    </style>
</head>
<body>

<div class="container">
    <h1>日麻点数计算器</h1>

    <div class="compact-grid">
        <div class="control-group" style="margin-bottom:0;">
            <span class="label-title">人数</span>
            <div class="radio-group">
                <input type="radio" id="mode4" name="gameMode" value="4" checked>
                <label for="mode4">四麻</label>
                <input type="radio" id="mode3" name="gameMode" value="3">
                <label for="mode3">三麻</label>
            </div>
        </div>

        <div class="control-group" style="margin-bottom:0;">
            <span class="label-title">自风</span>
            <div class="radio-group">
                <input type="radio" id="role_dealer" name="role" value="dealer">
                <label for="role_dealer">庄 (东)</label>
                <input type="radio" id="role_non_dealer" name="role" value="non_dealer" checked>
                <label for="role_non_dealer">闲 (子)</label>
            </div>
        </div>
    </div>

    <div class="control-group">
        <div class="radio-group">
            <input type="radio" id="win_ron" name="winType" value="ron" checked>
            <label for="win_ron">荣和 (Ron)</label>
            <input type="radio" id="win_tsumo" name="winType" value="tsumo">
            <label for="win_tsumo">自摸 (Tsumo)</label>
        </div>
    </div>

    <div class="control-group">
        <span class="label-title">番数 (Han)</span>
        <div class="stepper">
            <button class="stepper-btn" onclick="updateValue('han-input', -1)">-</button>
            <input type="number" id="han-input" min="1" max="13" value="1" readonly>
            <button class="stepper-btn" onclick="updateValue('han-input', 1)">+</button>
        </div>
    </div>

    <div id="fu-calculation-panel">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
            <span class="label-title" style="margin:0;">符数详情</span>
            <span id="fu-display" style="font-size:0.8rem; color:#e74c3c; font-weight:bold;">30符</span>
        </div>

        <div class="checkbox-container" style="margin-top: 0; margin-bottom: 8px;">
            <div class="checkbox-row special-row" onclick="toggleCheckbox('fu-chitoitsu')">
                <input type="checkbox" id="fu-chitoitsu" onclick="event.stopPropagation()">
                <label for="fu-chitoitsu">七对子 (25符固定)</label>
            </div>
        </div>

        <div id="normal-fu-area">
            <div class="fu-row">
                <label>明刻 (中张)</label>
                <div class="stepper">
                    <button class="stepper-btn" onclick="updateValue('triplet-open-simple', -1)">-</button>
                    <input type="number" id="triplet-open-simple" value="0" readonly>
                    <button class="stepper-btn" onclick="updateValue('triplet-open-simple', 1)">+</button>
                </div>
            </div>

            <div class="fu-row">
                <label>暗刻 (中张)</label>
                <div class="stepper">
                    <button class="stepper-btn" onclick="updateValue('triplet-closed-simple', -1)">-</button>
                    <input type="number" id="triplet-closed-simple" value="0" readonly>
                    <button class="stepper-btn" onclick="updateValue('triplet-closed-simple', 1)">+</button>
                </div>
            </div>

            <div class="fu-row">
                <label>明刻 (幺九/字)</label>
                <div class="stepper">
                    <button class="stepper-btn" onclick="updateValue('triplet-open-terminal', -1)">-</button>
                    <input type="number" id="triplet-open-terminal" value="0" readonly>
                    <button class="stepper-btn" onclick="updateValue('triplet-open-terminal', 1)">+</button>
                </div>
            </div>

            <div class="fu-row">
                <label>暗刻 (幺九/字)</label>
                <div class="stepper">
                    <button class="stepper-btn" onclick="updateValue('triplet-closed-terminal', -1)">-</button>
                    <input type="number" id="triplet-closed-terminal" value="0" readonly>
                    <button class="stepper-btn" onclick="updateValue('triplet-closed-terminal', 1)">+</button>
                </div>
            </div>

            <div class="checkbox-container">
                <div class="checkbox-row" onclick="toggleCheckbox('fu-bonus-pair')">
                    <input type="checkbox" id="fu-bonus-pair" onclick="event.stopPropagation()">
                    <label for="fu-bonus-pair">役牌雀头 (+2)</label>
                </div>
                <div class="checkbox-row" onclick="toggleCheckbox('fu-bonus-wait')">
                    <input type="checkbox" id="fu-bonus-wait" onclick="event.stopPropagation()">
                    <label for="fu-bonus-wait">坎/边/单骑 (+2)</label>
                </div>
            </div>
        </div>
    </div>

    <div id="result-area">
        <div class="result-title" id="res-title"></div>
        <div class="result-points" id="res-points">--</div>
        <div class="result-detail" id="res-detail">正在计算...</div>
    </div>
</div>

<script>
    function toggleCheckbox(id) {
        const checkbox = document.getElementById(id);
        checkbox.checked = !checkbox.checked;
        checkbox.dispatchEvent(new Event('change'));
    }

    function updateValue(inputId, change) {
        if (document.getElementById('normal-fu-area').classList.contains('disabled-area') && inputId !== 'han-input') {
            return;
        }

        const input = document.getElementById(inputId);
        let currentVal = parseInt(input.value) || 0;
        let newVal = currentVal + change;

        if (inputId === 'han-input') {
            if (newVal < 1) newVal = 1;
            if (newVal > 13) newVal = 13;
        } else {
            if (newVal < 0) newVal = 0;
            if (newVal > 4) newVal = 4;
        }

        input.value = newVal;
        input.dispatchEvent(new Event('input'));
    }

    /* 逻辑层 */
    const hanInput = document.getElementById('han-input');
    const fuPanel = document.getElementById('fu-calculation-panel');
    const fuDisplay = document.getElementById('fu-display');
    const normalFuArea = document.getElementById('normal-fu-area');
    const chitoitsuCheck = document.getElementById('fu-chitoitsu');

    // 绑定事件
    const allInputs = document.querySelectorAll('input');
    allInputs.forEach(input => {
        input.addEventListener('change', () => { handleLogicChange(); calculateScore(); });
        input.addEventListener('input', () => { handleLogicChange(); calculateScore(); });
    });

    function handleLogicChange() {
        const han = parseInt(hanInput.value) || 0;

        if (han < 5 && han > 0) {
            fuPanel.style.display = 'block';
        } else {
            fuPanel.style.display = 'none';
        }

        if(chitoitsuCheck.checked) {
            normalFuArea.classList.add('disabled-area');
        } else {
            normalFuArea.classList.remove('disabled-area');
        }

        if (han < 5) {
            const fu = calculateFu();
            let text = `${fu}符`;
            if (chitoitsuCheck.checked) text = "七对子(25)";
            fuDisplay.innerText = text;
        }
    }

    function calculateFu() {
        if (chitoitsuCheck.checked) return 25;

        const winType = document.querySelector('input[name="winType"]:checked').value;
        let fu = 20;

        const openSimple = parseInt(document.getElementById('triplet-open-simple').value) || 0;
        const closedSimple = parseInt(document.getElementById('triplet-closed-simple').value) || 0;
        const openTerminal = parseInt(document.getElementById('triplet-open-terminal').value) || 0;
        const closedTerminal = parseInt(document.getElementById('triplet-closed-terminal').value) || 0;

        fu += openSimple * 2;
        fu += closedSimple * 4;
        fu += openTerminal * 4;
        fu += closedTerminal * 8;

        if(document.getElementById('fu-bonus-pair').checked) fu += 2;
        if(document.getElementById('fu-bonus-wait').checked) fu += 2;

        if (winType === 'tsumo') {
            fu += 2;
        } else {
            if (openSimple === 0 && openTerminal === 0) {
                fu += 10;
            }
        }

        if (fu % 10 !== 0) fu = Math.ceil(fu / 10) * 10;
        if (winType === 'ron' && fu < 30) fu = 30;

        return fu;
    }

    function calculateScore() {
        const han = parseInt(hanInput.value) || 0;
        const isDealer = document.querySelector('input[name="role"]:checked').value === 'dealer';
        const winType = document.querySelector('input[name="winType"]:checked').value;
        const isSanma = document.querySelector('input[name="gameMode"]:checked').value === '3';

        let basicPoints = 0;
        let finalPoints = 0;
        let text = "";
        let subText = "";

        if (han >= 5) {
            if (han === 5) basicPoints = 2000;
            else if (han >= 6 && han <= 7) basicPoints = 3000;
            else if (han >= 8 && han <= 10) basicPoints = 4000;
            else if (han >= 11 && han <= 12) basicPoints = 6000;
            else if (han >= 13) basicPoints = 8000;
        } else {
            let fu = calculateFu();
            basicPoints = fu * Math.pow(2, 2 + han);
            if (basicPoints > 2000) basicPoints = 2000;
        }

        if (winType === 'ron') {
            if (isDealer) finalPoints = Math.ceil((basicPoints * 6) / 100) * 100;
            else finalPoints = Math.ceil((basicPoints * 4) / 100) * 100;
            text = `${finalPoints}`;
            subText = `放铳者支付`;
        } else {
            if (isDealer) {
                let payment = Math.ceil((basicPoints * 2) / 100) * 100;
                finalPoints = isSanma ? payment * 2 : payment * 3;
                text = `${finalPoints}`;
                subText = `每人 ${payment}`;
            } else {
                let paymentDealer = Math.ceil((basicPoints * 2) / 100) * 100;
                let paymentKo = Math.ceil((basicPoints * 1) / 100) * 100;
                finalPoints = isSanma ? paymentDealer + paymentKo : paymentDealer + (paymentKo * 2);
                text = `${finalPoints}`;
                subText = `庄${paymentDealer} / 闲${paymentKo}`;
            }
        }

        let title = "";
        if (basicPoints >= 8000) title = "【役满】";
        else if (basicPoints >= 6000) title = "【三倍满】";
        else if (basicPoints >= 4000) title = "【倍满】";
        else if (basicPoints >= 3000) title = "【跳满】";
        else if (basicPoints >= 2000) title = "【满贯】";

        // 补充信息：如果是小番数，显示符数
        if (han < 5) {
            let fu = calculateFu();
            if (chitoitsuCheck.checked) subText += ` (七对子 ${han}番)`;
            else subText += ` (${fu}符 ${han}番)`;
        } else {
            subText += ` (${han}番)`;
        }

        document.getElementById('res-title').innerText = title;
        document.getElementById('res-points').innerText = text;
        document.getElementById('res-detail').innerText = subText;
    }

    handleLogicChange();
    calculateScore();
</script>

</body>
</html>